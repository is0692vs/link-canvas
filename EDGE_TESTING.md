# エッジ描画機能のテスト手順

## テスト環境の準備

### 1. プロジェクトのビルド

```bash
npm install
npm run build
```

### 2. VS Code 拡張機能デバッグモード

1. VS Code でプロジェクトを開く
2. F5 キーを押して拡張機能開発ホストを起動
3. 新しいウィンドウで適当なプロジェクトを開く

## 基本テスト

### テスト 1: 手動でエッジを確認する

1. **Link Canvas を開く**
   - アクティビティバーの Link Canvas アイコンをクリック
   - サイドバーからファイルを選択してキャンバスに追加

2. **複数のファイルを追加**
   - 依存関係のある複数のファイルをキャンバスに追加
   - 例: `main.ts` と `calculator.ts` (main.ts が calculator.ts を import)

3. **エッジの表示を確認**
   - ファイル間に線（エッジ）が描画されることを確認
   - 矢印の方向が依存関係の方向と一致することを確認

### テスト 2: エッジのインタラクション

1. **ホバーテスト**
   - エッジの上にマウスカーソルを移動
   - エッジの色が変わること（グレー → 青）を確認
   - エッジの太さが少し増すことを確認

2. **クリックテスト**
   - エッジをクリック
   - ブラウザコンソールに `[Link Canvas] エッジクリック: <edge-id>` が表示されることを確認

### テスト 3: エッジのスタイル

1. **通常のエッジ**
   - 実線のエッジが描画されることを確認
   - デフォルトの色（グレー #888）を確認

2. **破線のエッジ（実装されている場合）**
   - 破線パターンが正しく表示されることを確認

### テスト 4: ズーム・パンでの動作

1. **ズームアウト**
   - Shift + マウスホイールでズームアウト
   - エッジがウィンドウと一緒にズームされることを確認

2. **ズームイン**
   - Shift + マウスホイールでズームイン
   - エッジの位置が正しく追従することを確認

3. **パン（移動）**
   - キャンバスをドラッグして移動
   - エッジがウィンドウと一緒に移動することを確認

### テスト 5: ウィンドウの移動・リサイズ

1. **ウィンドウの移動**
   - ウィンドウをドラッグして移動
   - エッジの始点・終点が正しく追従することを確認

2. **ウィンドウのリサイズ**
   - ウィンドウの角をドラッグしてリサイズ
   - エッジの接続ポイントが更新されることを確認

3. **ウィンドウの削除**
   - ウィンドウを閉じる
   - 関連するエッジも削除されることを確認

## 高度なテスト

### テスト 6: 自動依存関係検出

テストプロジェクトの構造:

```
test-project/
├── main.ts
│   └── import { Calculator } from './calculator';
│   └── import { Logger } from './logger';
├── calculator.ts
└── logger.ts
```

1. **main.ts を開く**
   - Link Canvas に main.ts を追加

2. **calculator.ts を開く**
   - Link Canvas に calculator.ts を追加
   - main.ts → calculator.ts のエッジが自動生成されることを確認

3. **logger.ts を開く**
   - Link Canvas に logger.ts を追加
   - main.ts → logger.ts のエッジが自動生成されることを確認

### テスト 7: 複雑な依存関係

```
main.ts → calculator.ts
main.ts → logger.ts
calculator.ts → utils.ts
logger.ts → utils.ts
```

1. すべてのファイルをキャンバスに追加
2. 4 本のエッジが正しく描画されることを確認
3. エッジが重ならずに配置されることを確認

### テスト 8: エッジの接続ポイント

1. **右→左の接続**（デフォルト）
   - 横並びのウィンドウ間でエッジを確認
   - 左ウィンドウの右端から右ウィンドウの左端へ接続されることを確認

2. **他の接続パターン**（将来実装）
   - 上→下
   - 下→上
   - など

## トラブルシューティング

### エッジが表示されない場合

1. **ブラウザコンソールを確認**
   ```
   F12 → Console タブ
   ```
   - エラーメッセージを確認
   - `[Link Canvas]` で始まるログを検索

2. **ウィンドウ ID を確認**
   - Console で `windows` の state を確認
   - `edges` の state を確認
   - source/target ID が一致するか確認

3. **SVG 要素を確認**
   ```
   F12 → Elements タブ → <svg class="edge-canvas"> を検索
   ```
   - SVG 要素が DOM に存在するか確認
   - path 要素が正しく生成されているか確認

### エッジがクリックできない場合

1. **透明な太い線を確認**
   - Elements タブで透明なクリック用 path を確認
   - `stroke="transparent"` の path が存在するか

2. **z-index を確認**
   - EdgeCanvas の z-index が適切か確認
   - ウィンドウに隠れていないか確認

### パフォーマンス問題

1. **エッジ数を確認**
   - Console で `edges.length` を確認
   - 大量のエッジがある場合は最適化が必要

2. **ブラウザのパフォーマンスツール**
   ```
   F12 → Performance タブ → Record
   ```
   - 描画のボトルネックを特定

## デバッグ用コード

### コンソールでエッジを追加

```javascript
// ブラウザコンソールで実行（開発時のみ）
const testEdge = {
  id: 'debug-edge-1',
  source: 'test-window-1',
  target: 'test-window-2',
  sourceHandle: 'right',
  targetHandle: 'left',
  style: { color: '#ff0000', width: 3 }
};

// React DevTools を使用して edges state に追加
```

### エッジ情報を表示

```javascript
// ブラウザコンソールで実行
console.table(edges);
console.table(windows.map(w => ({
  id: w.id,
  fileName: w.fileName,
  x: w.position.x,
  y: w.position.y
})));
```

## 期待される結果

### 成功基準

- ✅ エッジが正しく描画される
- ✅ 矢印マーカーが表示される
- ✅ ホバー時にハイライトされる
- ✅ クリック時にコンソールログが出力される
- ✅ ズーム・パンで正しく追従する
- ✅ ウィンドウ移動・リサイズで正しく更新される
- ✅ ウィンドウ削除時にエッジも削除される
- ✅ 自動依存関係検出が動作する

### パフォーマンス基準

- エッジ描画が滑らか（60fps）
- ウィンドウ移動時のラグがない
- メモリリークがない

## 報告すべき問題

以下の問題を発見した場合は GitHub Issue で報告してください：

1. エッジが表示されない
2. エッジの座標が正しくない
3. クリック・ホバーが反応しない
4. パフォーマンスの問題
5. ズーム・パン時の不具合
6. 自動依存関係検出の誤検出

報告時には以下の情報を含めてください：
- OS とバージョン
- VS Code バージョン
- ブラウザコンソールのエラーログ
- 再現手順のスクリーンショット
