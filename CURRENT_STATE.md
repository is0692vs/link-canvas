了解しました。まず今の修正を試してみて、ダメだったら以下のレポートを使ってください。

---

# Issue #1 完了時の理想状態と現状のギャップレポート

## 📋 Issue #1 の完了条件（理想の状態）

### 動作すべき機能

1. **ファイル追加**: サイドバーから複数ファイルをクリック → 同じキャンバスに追加される
2. **ズーム操作**:
   - Shift+マウスホイール上: ズームイン（0.1 刻み、最大 1.0）
   - Shift+マウスホイール下: ズームアウト（0.1 刻み、最小 0.1）
   - サイドバーの+ボタン: ズームイン
   - サイドバーの-ボタン: ズームアウト
3. **ズームレベルによる表示切替**:
   - ズーム < 1.0: FilePreview 表示（ファイル名、クラス一覧、関数一覧）
   - ズーム >= 1.0: Monaco Editor 表示（コード全体）
4. **Monaco Editor 操作**（ズーム 1.0 時）:
   - テキスト選択（マウスドラッグ）
   - スクロール（マウスホイール）
   - Cmd +/-: フォントサイズ変更
   - Cmd 0: フォントサイズリセット
5. **ウィンドウ操作**:
   - タイトルバーをドラッグ: ウィンドウ移動
   - 8 方向のリサイズハンドル: ウィンドウサイズ変更
   - × ボタン: ウィンドウ削除（ドラッグ開始しない）
6. **コンテンツエリアの挙動**:
   - Monaco Editor/FilePreview 内でマウス操作してもウィンドウがドラッグ移動しない

---

## ❌ 現状の状態

### 動作している機能

- ✅ ファイル追加（同じキャンバスに追加）
- ✅ Shift+マウスホイールでズームイン/アウト（方向正しい）
- ✅ サイドバー+/-ボタンでズームイン/アウト
- ✅ ズームレベルによる表示切替（Preview ⇔ Monaco）
- ✅ Monaco Editor が正しくレイアウト（400x268px）

### 動作していない機能

- ❌ **Monaco Editor 内の全操作が効かない**:
  - テキスト選択不可
  - スクロール不可
  - Cmd +/- のフォントサイズ変更は効く（これだけ動く）
- ❌ **ウィンドウドラッグ移動不可**:
  - タイトルバーをドラッグしても移動しない
- ❌ **リサイズ不可**:
  - 8 方向のハンドルをドラッグしてもサイズ変更しない
- ❌ **× ボタンが効かない**:
  - クリックしても削除されない

### 視覚的な状態

- Monaco Editor は画面に表示されている（白い背景にコードが見える）
- ウィンドウの UI は正常（タイトルバー、リサイズハンドル、× ボタン全て見える）
- しかし、すべてのマウス操作が反応しない（凍結状態）

---

## 🔧 試したアプローチ

### アプローチ 1: stopPropagation（初期実装）

**実装内容**:

- タイトルバー: 条件付き stopPropagation（ボタン以外は伝播）
- コンテンツエリア: stopPropagation
- リサイズハンドル: useResize 内で stopPropagation

**結果**: ❌ すべての操作が効かない

**原因仮説**: stopPropagation が React Flow のドラッグだけでなく、Monaco Editor の内部イベントまでブロック

---

### アプローチ 2: nodrag クラス（Copilot 実装）

**実装内容**:

- index.tsx: `noDragClassName="nodrag"`設定済み
- × ボタン: `nodrag`クラス追加
- コンテンツエリア: `nodrag`クラス追加
- **リサイズハンドル（8 個すべて）**: `nodrag`クラス追加 ← これが問題

**結果**: ❌ すべての操作が効かない

**原因仮説**: リサイズハンドルへの`nodrag`追加により、リサイズが無効化。コンテンツエリアの`nodrag`が Monaco Editor の操作もブロック

---

### アプローチ 3: リサイズハンドルの nodrag 削除（現在試行中）

**実装内容**:

- タイトルバー: `nodrag`なし
- × ボタン: `nodrag`あり
- コンテンツエリア: `nodrag`あり
- リサイズハンドル: `nodrag`なし（削除）

**結果**: （これから確認）

---

## 🎯 実装すべき正解

### 期待される動作

1. **タイトルバー**: React Flow のドラッグ有効（ノード移動）
2. **× ボタン**: React Flow のドラッグ無効（クリックのみ）
3. **コンテンツエリア**: React Flow のドラッグ無効 + Monaco Editor 操作有効
4. **リサイズハンドル**: useResize 独自のドラッグ処理が動作

### 技術的な要件

- Monaco Editor へのマウスイベントが正常に届く
- React Flow のノードドラッグとリサイズドラッグが共存する
- イベント伝播を適切に制御（ブロックしすぎない）

---

## 📊 ログ情報（参考）

```
[Link Canvas] Monaco DOM サイズ（レイアウト後） {fileName: 'main.ts', width: 400, height: 268}
[Link Canvas] Shift+ホイール ズームイン: 0.900 → 1.000
[Link Canvas] CodeWindow レンダリング {fileName: 'main.ts', isPreviewMode: false, zoomLevel: 1}
```

- Monaco Editor は正しくマウント・レイアウトされている
- ズーム機能は正常動作
- しかしマウスインタラクションが一切効かない

---

この状態を解決する実装を提案してください。
